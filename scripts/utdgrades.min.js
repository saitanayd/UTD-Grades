/* 
 *  Coded by Sai Tanay Desaraju.
 *  07/21/19.
 */

var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var h=0;return function(){return h<a.length?{done:!1,value:a[h++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var h="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return h?h.call(a):$jscomp.arrayIterator(a)};var resJQ=$("#search-results"),maxResults=20,database={},searches=[];
$(function(){$.getJSON("./data.json",function(a){database=a}).fail(function(){$("body").text("Error Occurred. Class data couldn't be loaded.")})});$("#search-input-group > div > .dropdown-item").on("click",function(){$("#search-term").attr("value",$(this).text()).text($(this).attr("value"));querySubmit()});
function querySubmit(){var a=document.getElementById("search-subj").value.toString().trim().toUpperCase(),h=document.getElementById("search-num").value.toString().trim(),l=document.getElementById("search-sect").value.toString().trim(),f=document.getElementById("search-prof").value.toString().trim().toLowerCase(),c=document.getElementById("search-term").value.toString();if(2>(""===a?0:1)+(""===h?0:1)+(""===l?0:1)+(1>f.length?0:2))resJQ.empty();else{"All"===c&&(c="");for(var g=[a,h,l,f,c],d=searches.length-
1;0<=d;){for(var b=!0,e=0;5>e;e++)if(!g[e].startsWith(searches[d].query[e])){b=!1;break}if(b)break;searches.pop();d--}if(0<searches.length){d=!0;b=searches[searches.length-1];for(e=0;5>e;e++)if(g[e]!==b.query[e]){d=!1;break}if(d){addClassSearchResults(searches[searches.length-1].result);return}}a=search(a,h,l,f,c);0===a.length?showNoResultsAlert():(addClassSearchResults(a),searches.push({query:g,result:a}))}}
function search(a,h,l,f,c){function g(b){if(b.subj.startsWith(a)&&b.num.startsWith(h)&&b.term.startsWith(c)&&b.sect.startsWith(l)){if(""===f)return!0;"string"===typeof f&&(f=f.split(" "));for(var e=$jscomp.makeIterator(f),d=e.next();!d.done;d=e.next()){d=d.value;for(var g=!1,n=$jscomp.makeIterator(b.prof_array),m=n.next();!m.done;m=n.next())if(m.value.startsWith(d)){g=!0;break}if(!g)return!1}return!0}return!1}var d=[],b=searches.length-1;if(-1===b)for(b=0;b<database.length;b++)g(database[b])&&d.push(b);
else{b=searches[b].result;for(var e=0;e<b.length;e++)g(database[b[e]])&&d.push(b[e])}return d}function showNoResultsAlert(){0===resJQ.find(".alert").length&&resJQ.fadeOut(30,function(){resJQ.empty();resJQ.append('<div class="alert alert-light" role="alert">No results found!</div>').fadeIn(200)})}
function addClassSearchResults(a){resJQ.empty();var h=maxResults,l=$("#right_area_container"),f={};a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;f={$jscomp$loop$prop$x$9:f.$jscomp$loop$prop$x$9},c=a.next()){f.$jscomp$loop$prop$x$9=c.value;c=database[f.$jscomp$loop$prop$x$9];var g=c.grades;resJQ.append('<div class="card class-info-card w-100 mr-3 mb-3 overflow-hidden" id="card-'+f.$jscomp$loop$prop$x$9+'"><div class="row"><div class="col-4 pr-0 mh-100"></div><div class="col-8"><div class="card-body p-md-1 p-1"><p class="class-id font-weight-normal text-truncate mb-0">'+
c.subj+" "+c.num+" "+c.sect+'</p><p class="professor text-muted text-truncate mb-0">'+c.prof+'</p><p class="semester text-muted text-truncate mb-0">'+c.term+"</p></div></div></div></div>");c=$("#card-"+f.$jscomp$loop$prop$x$9).on("click",function(a){return function(){"none"===l.css("display")?$("#btn_back").off("click").on("click",function(){$("#btn_back").hide();$("#btn_reddit").hide();$("#btn_rmp").hide();l.hide(200,function(){return $("#left-bar").show(200,function(){return window.location.hash=
"#card-"+a.$jscomp$loop$prop$x$9})})}).show(function(){return $("#left-bar").hide(function(){showMainChart(a.$jscomp$loop$prop$x$9);l.css("display","flex")})}):showMainChart(a.$jscomp$loop$prop$x$9)}}(f));var d="",b=0,e=0,m;for(m in g){var k=parseInt(g[m]);k>b&&(b=k);e++}b*=1.2;e=100/e;g=$jscomp.makeIterator(Object.values(g));for(k=g.next();!k.done;k=g.next())k=Math.ceil(100*(1-k.value/b)),d+='<div class="d-inline-block h-100" style="width: '+e+"%; background: linear-gradient(to bottom, #ced4da "+
k+"%, #343a40 "+k+'%);"></div>';c.find("div > div.col-4.pr-0.mh-100").append(d);if(0>=--h)break}}
function showMainChart(a){a=database[a];var h=a.term,l=a.subj,f=a.num,c=a.sect,g=a.prof,d=a.grades,b=Object.values(d).reduce(function(a,b){return a+parseInt(b)},0),e="A+ A A- B+ B B- C+ C C- D+ D D- F W I".split(" "),m="#2eb43f #30c737 #6bd40f #93d10d #cdff4f #ffe14d #ffd036 #ffc023 #ffad33 #ff704d #f54ad7 #f500a0 #dc3545 #dc4050 #336eb4".split(" "),k=g.split(",").reverse().map(function(a){return a.split(" ").map(function(a){return 1<a.length?a:""}).join(" ")}).join(" ");$("#btn_rmp").off("click").on("click",
function(){window.open("https://www.ratemyprofessors.com/search.jsp?query="+encodeURI(k+" UT Dallas"),"_blank")}).css("display","block");$("#btn_reddit").off("click").on("click",function(){window.open("https://www.reddit.com/r/utdallas/search/?q="+encodeURI(k)+"&restrict_sr=1","_blank")}).css("display","block");Highcharts.chart("main-chart",{chart:{type:"column",backgroundColor:"#f8f9fa"},title:{text:l+" "+f+"."+c},subtitle:{text:g+" - "+h+" - "+b+" Students"},legend:{enabled:!1},credits:{enabled:!1},
xAxis:{title:{text:"Grades"},categories:Object.keys(d).map(function(a){return a||"Ungraded"})},yAxis:{title:{text:"Students"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'\n                <tr>\n                    <td style="color:{series.color};padding:0">{series.name}: </td>\n                    <td style="padding:0"><b>{point.y}</b></td>\n                </tr>\n                <tr>\n                    <td style="color:{series.color};padding:0">Percentage: </td>\n                    <td style="padding:0"><b>{point.percentage:.2f}%</b></td>\n                </tr>\n                ',
footerFormat:"</table>",backgroundColor:"#f8f9fa",borderColor:"#ced4da",borderRadius:6,useHTML:!0},series:[{name:"Students",data:function(){var a=[],c;for(c in d){var f=e.indexOf(c);a.push({color:-1===f?"#2986ff":m[f],y:parseInt(d[c]),percentage:d[c]/b*100})}return a}()}]})};