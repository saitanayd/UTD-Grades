/* 
 *  Coded by Sai Tanay Desaraju.
 *  07/22/19.
 */

var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(b){var a=0;return function(){return a<b.length?{done:!1,value:b[a++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.makeIterator=function(b){var a="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];return a?a.call(b):$jscomp.arrayIterator(b)};var resJQ=$("#search-results"),maxResults=50,database={},searches=[];
$(function(){$.getJSON("./data.json",function(b){database=b}).fail(function(){$("body").text("Error Occurred. Class data couldn't be loaded.")}).done(function(){if(0!==window.location.search.length){var b=new URLSearchParams(window.location.search),a=b.get("id");if(null!==a)a<Object.keys(database).length?(addClassSearchResults([a]),showMainChart(a)):console.log("Index "+a+" from url params equals or exceeds the database length. Class load failed.");else{b=$jscomp.makeIterator(b.entries());for(a=b.next();!a.done;a=
    b.next())switch(a=a.value,a[0]){case "subj":$("#search-subj").val(a[1]);break;case "num":$("#search-num").val(a[1]);break;case "sect":$("#search-sect").val(a[1]);break;case "prof":$("#search-prof").val(a[1]);break;case "term":a[1]=a[1].toLowerCase();var d=a[1];switch(d[2]){case "s":d="Spring 20"+d[0]+d[1];break;case "f":d="Fall 20"+d[0]+d[1];break;case "u":d="Summer 20"+d[0]+d[1];break;default:console.log("term couldn't be parsed")}$("#search-term").attr("value",d).text(a[1]);break;default:console.log("Couldn't parse URL param: "+
    a+"="+a[1])}querySubmit()}}})});$(function(){$('[data-toggle="tooltip"]').tooltip();$('[data-toggle="popover"]').popover()});$(window).on("resize ready",function(){768<=$(window).width()?($("#search-input-group").removeClass("input-group-sm"),$("#search-term").removeClass("btn-sm")):($("#search-input-group").addClass("input-group-sm"),$("#search-term").addClass("btn-sm"))});
$("#search-input-group > div > .dropdown-item").on("click",function(){$("#search-term").attr("value",$(this).text()).text($(this).attr("value"));querySubmit()});
function querySubmit(){var b=document.getElementById("search-subj").value.trim().toUpperCase(),a=document.getElementById("search-num").value.trim(),d=document.getElementById("search-sect").value.trim(),h=document.getElementById("search-prof").value.trim().toLowerCase(),g=document.getElementById("search-term").value;if(2>(""===b?0:1)+(""===a?0:1)+(""===d?0:1)+(1>h.length?0:2))resJQ.empty();else{"All"===g&&(g="");for(var k=[b,a,d,h,g],f=searches.length-1;0<=f;){for(var c=!0,e=0;5>e;e++)if(!k[e].startsWith(searches[f].query[e])){c=
    !1;break}if(c)break;searches.pop();f--}if(0<searches.length){f=!0;c=searches[searches.length-1];for(e=0;5>e;e++)if(k[e]!==c.query[e]){f=!1;break}if(f){addClassSearchResults(searches[searches.length-1].result);return}}b=search(b,a,d,h,g);0===b.length?showNoResultsAlert():(addClassSearchResults(b),searches.push({query:k,result:b}))}}
function search(b,a,d,h,g){function k(c){if(c.subj.startsWith(b)&&c.num.startsWith(a)&&c.term.startsWith(g)&&c.sect.startsWith(d)){if(""===h)return!0;"string"===typeof h&&(h=h.split(" "));for(var e=$jscomp.makeIterator(h),f=e.next();!f.done;f=e.next()){f=f.value;for(var k=!1,q=$jscomp.makeIterator(c.prof_array),n=q.next();!n.done;n=q.next())if(n.value.startsWith(f)){k=!0;break}if(!k)return!1}return!0}return!1}var f=[],c=searches.length-1;if(-1===c)for(c=0;c<database.length;c++)k(database[c])&&f.push(c);
else{c=searches[c].result;for(var e=0;e<c.length;e++)k(database[c[e]])&&f.push(c[e])}return f}function showNoResultsAlert(){0===resJQ.find(".alert").length&&resJQ.fadeOut(30,function(){resJQ.empty();resJQ.append('<div class="alert alert-light" role="alert">No results found!</div>').fadeIn(200)})}
function addClassSearchResults(b){resJQ.empty();var a=maxResults,d=$("#right_area_container"),h={};b=$jscomp.makeIterator(b);for(var g=b.next();!g.done;h={$jscomp$loop$prop$x$10:h.$jscomp$loop$prop$x$10},g=b.next()){h.$jscomp$loop$prop$x$10=g.value;if(0>=a){resJQ.append('<div class="alert alert-light" role="alert">Search too broad! Only the top '+maxResults+" results are being shown.</div>");break}g=database[h.$jscomp$loop$prop$x$10];var k=g.grades;resJQ.append('<div class="card class-info-card w-100 mr-3 mb-3 overflow-hidden" id="card-'+
    h.$jscomp$loop$prop$x$10+'"><div class="row"><div class="col-4 pr-0 mh-100"></div><div class="col-8"><div class="card-body p-md-1 p-1"><p class="class-id font-weight-normal text-truncate mb-0">'+g.subj.toUpperCase()+" "+g.num+" "+g.sect.toUpperCase()+'</p><p class="professor text-muted text-truncate mb-0">'+g.prof+'</p><p class="semester text-muted text-truncate mb-0">'+g.term+"</p></div></div></div></div>");g=$("#card-"+h.$jscomp$loop$prop$x$10).on("click",function(a){return function(){"none"===
d.css("display")?$("#btn_back").off("click").on("click",function(){d.slideUp(300,function(){$("#left-bar").show(0,function(){return window.location.hash="#card-"+a.$jscomp$loop$prop$x$10})});$("#btn_back").hide();$("#btn_reddit").hide();$("#btn_rmp").hide();$("#btn_share").hide();$("#btn_share").popover("hide")}).show(function(){return $("#left-bar").hide(0,function(){showMainChart(a.$jscomp$loop$prop$x$10);d.slideDown(300)})}):($("#btn_share").popover("hide"),showMainChart(a.$jscomp$loop$prop$x$10))}}(h));
    var f="",c=0,e=0,m;for(m in k){var l=parseInt(k[m]);l>c&&(c=l);e++}c*=1.2;e=100/e;k=$jscomp.makeIterator(Object.values(k));for(l=k.next();!l.done;l=k.next())l=Math.ceil(100*(1-l.value/c)),f+='<div class="d-inline-block h-100" style="width: '+e+"%; background: linear-gradient(to bottom, #ced4da "+l+"%, #343a40 "+l+'%);"></div>';g.find("div > div.col-4.pr-0.mh-100").append(f);--a}}
function showMainChart(b){var a=database[b],d=a.term,h=a.subj,g=a.num,k=a.sect,f=a.prof,c=a.grades,e=Object.values(c).reduce(function(a,b){return a+parseInt(b)},0),m="A+ A A- B+ B B- C+ C C- D+ D D- F W I".split(" "),l="#2eb43f #30c737 #6bd40f #93d10d #cdff4f #ffe14d #ffd036 #ffc023 #ffad33 #ff704d #f54ad7 #f500a0 #dc3545 #dc4050 #336eb4".split(" "),p=f.split(",").reverse().map(function(a){return a.split(" ").map(function(a){return 1<a.length?a:""}).join(" ")}).join(" ");$("#hint-text").hide();$("#btn_rmp").off("click").on("click",
    function(){window.open("https://www.ratemyprofessors.com/search.jsp?query="+encodeURI(p+" UT Dallas"),"_blank")}).css("display","block");$("#btn_reddit").off("click").on("click",function(){window.open("https://www.reddit.com/r/utdallas/search/?q="+encodeURI(p)+"&restrict_sr=1","_blank")}).css("display","block");$("#btn_share").attr("data-content",function(){return window.location.origin+"/utd-grades/?id="+b}).css("display","block");Highcharts.chart("main-chart",{chart:{type:"column",backgroundColor:"#f8f9fa"},
    title:{text:h+" "+g+"."+k},subtitle:{text:f+" - "+d+" - "+e+" Students"},legend:{enabled:!1},credits:{enabled:!1},xAxis:{title:{text:"Grades"},categories:Object.keys(c).map(function(a){return a||"Ungraded"})},yAxis:{title:{text:"Students"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'\n                <tr>\n                    <td style="color:{series.color};padding:0">{series.name}: </td>\n                    <td style="padding:0"><b>{point.y}</b></td>\n                </tr>\n                <tr>\n                    <td style="color:{series.color};padding:0">Percentage: </td>\n                    <td style="padding:0"><b>{point.percentage:.2f}%</b></td>\n                </tr>\n                ',
        footerFormat:"</table>",backgroundColor:"#f8f9fa",borderColor:"#ced4da",borderRadius:6,useHTML:!0},series:[{name:"Students",data:function(){var a=[],b;for(b in c){var d=m.indexOf(b);a.push({color:-1===d?"#2986ff":l[d],y:parseInt(c[b]),percentage:c[b]/e*100})}return a}()}]})};