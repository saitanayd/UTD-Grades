/* 
 *  Coded by Sai Tanay Desaraju.
 *  07/22/19.
 */

var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};var resJQ=$("#search-results"),maxResults=50,database={},searches=[];
$(function(){$.getJSON("./data.json",function(a){database=a}).fail(function(){$("body").text("Error Occurred. Class data couldn't be loaded.")}).done(function(){var a=new URLSearchParams(window.location.search),b=a.get("id");if(null!==b)b<Object.keys(database).length?(addClassSearchResults([b]),showMainChart(b)):console.log("Index "+b+" from url params equals or exceeds the database length. Class load failed.");else{b=$jscomp.makeIterator(Object.keys(a));for(var h=b.next();!h.done;h=b.next())switch(h=
h.value,h){case "subj":$("#search-subj").text(a.i);break;case "num":$("#search-num").text(a.i);break;case "sect":$("#search-subj").text(a.i);break;case "prof":$("#search-prof").text(a.i);break;case "term":$("#search-term").text(a.i);break;default:console.log("Couldn't parse URL param: "+h+": "+a.i)}}})});$(function(){$('[data-toggle="tooltip"]').tooltip();$('[data-toggle="popover"]').popover()});
$(window).on("resize ready",function(){768<=$(window).width()?($("#search-input-group").removeClass("input-group-sm"),$("#search-term").removeClass("btn-sm")):($("#search-input-group").addClass("input-group-sm"),$("#search-term").addClass("btn-sm"))});$("#search-input-group > div > .dropdown-item").on("click",function(){$("#search-term").attr("value",$(this).text()).text($(this).attr("value"));querySubmit()});
function querySubmit(){var a=document.getElementById("search-subj").value.toString().trim().toUpperCase(),b=document.getElementById("search-num").value.toString().trim(),h=document.getElementById("search-sect").value.toString().trim(),g=document.getElementById("search-prof").value.toString().trim().toLowerCase(),f=document.getElementById("search-term").value.toString();if(2>(""===a?0:1)+(""===b?0:1)+(""===h?0:1)+(1>g.length?0:2))resJQ.empty();else{"All"===f&&(f="");for(var k=[a,b,h,g,f],d=searches.length-
1;0<=d;){for(var c=!0,e=0;5>e;e++)if(!k[e].startsWith(searches[d].query[e])){c=!1;break}if(c)break;searches.pop();d--}if(0<searches.length){d=!0;c=searches[searches.length-1];for(e=0;5>e;e++)if(k[e]!==c.query[e]){d=!1;break}if(d){addClassSearchResults(searches[searches.length-1].result);return}}a=search(a,b,h,g,f);0===a.length?showNoResultsAlert():(addClassSearchResults(a),searches.push({query:k,result:a}))}}
function search(a,b,h,g,f){function k(c){if(c.subj.startsWith(a)&&c.num.startsWith(b)&&c.term.startsWith(f)&&c.sect.startsWith(h)){if(""===g)return!0;"string"===typeof g&&(g=g.split(" "));for(var e=$jscomp.makeIterator(g),d=e.next();!d.done;d=e.next()){d=d.value;for(var k=!1,q=$jscomp.makeIterator(c.prof_array),n=q.next();!n.done;n=q.next())if(n.value.startsWith(d)){k=!0;break}if(!k)return!1}return!0}return!1}var d=[],c=searches.length-1;if(-1===c)for(c=0;c<database.length;c++)k(database[c])&&d.push(c);
else{c=searches[c].result;for(var e=0;e<c.length;e++)k(database[c[e]])&&d.push(c[e])}return d}function showNoResultsAlert(){0===resJQ.find(".alert").length&&resJQ.fadeOut(30,function(){resJQ.empty();resJQ.append('<div class="alert alert-light" role="alert">No results found!</div>').fadeIn(200)})}
function addClassSearchResults(a){resJQ.empty();var b=maxResults,h=$("#right_area_container"),g={};a=$jscomp.makeIterator(a);for(var f=a.next();!f.done;g={$jscomp$loop$prop$x$10:g.$jscomp$loop$prop$x$10},f=a.next()){g.$jscomp$loop$prop$x$10=f.value;if(0>=b){resJQ.append('<div class="alert alert-light" role="alert">Search is too broad! Only the top '+maxResults+" results are being shown.</div>");break}f=database[g.$jscomp$loop$prop$x$10];var k=f.grades;resJQ.append('<div class="card class-info-card w-100 mr-3 mb-3 overflow-hidden" id="card-'+
g.$jscomp$loop$prop$x$10+'"><div class="row"><div class="col-4 pr-0 mh-100"></div><div class="col-8"><div class="card-body p-md-1 p-1"><p class="class-id font-weight-normal text-truncate mb-0">'+f.subj+" "+f.num+" "+f.sect+'</p><p class="professor text-muted text-truncate mb-0">'+f.prof+'</p><p class="semester text-muted text-truncate mb-0">'+f.term+"</p></div></div></div></div>");f=$("#card-"+g.$jscomp$loop$prop$x$10).on("click",function(a){return function(){"none"===h.css("display")?$("#btn_back").off("click").on("click",
function(){h.slideUp(300,function(){$("#left-bar").show(0,function(){return window.location.hash="#card-"+a.$jscomp$loop$prop$x$10})});$("#btn_back").hide();$("#btn_reddit").hide();$("#btn_rmp").hide();$("#btn_share").hide();$("#btn_share").popover("hide")}).show(function(){return $("#left-bar").hide(0,function(){showMainChart(a.$jscomp$loop$prop$x$10);h.slideDown(300)})}):showMainChart(a.$jscomp$loop$prop$x$10)}}(g));var d="",c=0,e=0,m;for(m in k){var l=parseInt(k[m]);l>c&&(c=l);e++}c*=1.2;e=100/
e;k=$jscomp.makeIterator(Object.values(k));for(l=k.next();!l.done;l=k.next())l=Math.ceil(100*(1-l.value/c)),d+='<div class="d-inline-block h-100" style="width: '+e+"%; background: linear-gradient(to bottom, #ced4da "+l+"%, #343a40 "+l+'%);"></div>';f.find("div > div.col-4.pr-0.mh-100").append(d);--b}}
function showMainChart(a){var b=database[a],h=b.term,g=b.subj,f=b.num,k=b.sect,d=b.prof,c=b.grades,e=Object.values(c).reduce(function(a,c){return a+parseInt(c)},0),m="A+ A A- B+ B B- C+ C C- D+ D D- F W I".split(" "),l="#2eb43f #30c737 #6bd40f #93d10d #cdff4f #ffe14d #ffd036 #ffc023 #ffad33 #ff704d #f54ad7 #f500a0 #dc3545 #dc4050 #336eb4".split(" "),p=d.split(",").reverse().map(function(a){return a.split(" ").map(function(a){return 1<a.length?a:""}).join(" ")}).join(" ");$("#hint-text").hide();$("#btn_rmp").off("click").on("click",
function(){window.open("https://www.ratemyprofessors.com/search.jsp?query="+encodeURI(p+" UT Dallas"),"_blank")}).css("display","block");$("#btn_reddit").off("click").on("click",function(){window.open("https://www.reddit.com/r/utdallas/search/?q="+encodeURI(p)+"&restrict_sr=1","_blank")}).css("display","block");$("#btn_share").attr("data-content",function(){return window.location.origin+"/utd-grades/?id="+a}).css("display","block");Highcharts.chart("main-chart",{chart:{type:"column",backgroundColor:"#f8f9fa"},
title:{text:g+" "+f+"."+k},subtitle:{text:d+" - "+h+" - "+e+" Students"},legend:{enabled:!1},credits:{enabled:!1},xAxis:{title:{text:"Grades"},categories:Object.keys(c).map(function(a){return a||"Ungraded"})},yAxis:{title:{text:"Students"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'\n                <tr>\n                    <td style="color:{series.color};padding:0">{series.name}: </td>\n                    <td style="padding:0"><b>{point.y}</b></td>\n                </tr>\n                <tr>\n                    <td style="color:{series.color};padding:0">Percentage: </td>\n                    <td style="padding:0"><b>{point.percentage:.2f}%</b></td>\n                </tr>\n                ',
footerFormat:"</table>",backgroundColor:"#f8f9fa",borderColor:"#ced4da",borderRadius:6,useHTML:!0},series:[{name:"Students",data:function(){var a=[],b;for(b in c){var d=m.indexOf(b);a.push({color:-1===d?"#2986ff":l[d],y:parseInt(c[b]),percentage:c[b]/e*100})}return a}()}]})};