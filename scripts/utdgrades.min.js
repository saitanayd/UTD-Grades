/* 
 *  Coded by Sai Tanay Desaraju.
 *  07/20/19.
 */

var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var c=0;return function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var c="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return c?c.call(a):$jscomp.arrayIterator(a)};var resJQ=$("#search-results"),database={},searches=[];$(function(){$.getJSON("./data.json",function(a){database=a}).fail(function(){$("body").text("Error Occurred. Class data couldn't be loaded.")})});
$("#search-input-group > div > .dropdown-item").on("click",function(){$("#search-term").attr("value",$(this).attr("value")).text($(this).text());querySubmit()});
function querySubmit(){var a=document.getElementById("search-subj").value.toString().trim().toUpperCase(),c=document.getElementById("search-num").value.toString().trim(),g=document.getElementById("search-sect").value.toString().trim(),f=document.getElementById("search-prof").value.toString().trim().toLowerCase(),k=document.getElementById("search-term").innerText;if(2>(""===a?0:1)+(""===c?0:1)+(""===g?0:1)+(""===f?0:2))resJQ.empty();else{"All"===k&&(k="");for(var h=[a,c,g,f,k],d=searches.length-1;0<=
d;){for(var b=!0,e=0;5>e;e++)if(!h[e].startsWith(searches[d].query[e])){b=!1;break}if(b)break;searches.pop();d--}if(0<searches.length){d=!0;b=searches[searches.length-1];for(e=0;5>e;e++)if(h[e]!==b.query[e]){d=!1;break}if(d){addClassSearchResults(searches[searches.length-1].result);return}}a=search(a,c,g,f,k);0===a.length?showNoResultsAlert():(addClassSearchResults(a),searches.push({query:h,result:a}))}}
function search(a,c,g,f,k){function h(b){if(b.subj.startsWith(a)&&b.num.startsWith(c)&&b.term.startsWith(k)&&b.sect.startsWith(g)){if(""===f)return!0;"string"===typeof f&&(f=f.split(" "));for(var d=$jscomp.makeIterator(f),e=d.next();!e.done;e=d.next()){e=e.value;for(var h=!1,n=$jscomp.makeIterator(b.prof_array),l=n.next();!l.done;l=n.next())if(l.value.startsWith(e)){h=!0;break}if(!h)return!1}return!0}return!1}var d=[],b=searches.length-1;if(-1===b)for(b=0;b<database.length;b++)h(database[b])&&d.push(b);
else{b=searches[b].result;for(var e=0;e<b.length;e++)h(database[b[e]])&&d.push(b[e])}return d}function showNoResultsAlert(){0===resJQ.find(".alert").length&&resJQ.fadeOut(30,function(){resJQ.empty();resJQ.append('<div class="alert alert-light" role="alert">No results found!</div>').fadeIn(200)})}
function addClassSearchResults(a){resJQ.empty();a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next()){c=c.value;var g=database[c],f=g.grades;resJQ.append('<div class="card class-info-card w-100 mr-3 mb-3 overflow-hidden" onclick="showMainChart('+c+');"><div class="row"><div class="col-sm-4 pr-0 mh-100 d-none d-sm-block" id="card-'+c+'" ></div><div class="col-sm-8"><div class="card-body p-md-1 p-sm-3"><p class="class-id font-weight-normal text-truncate mb-0">'+g.subj+" "+g.num+" "+g.sect+
'</p><p class="professor text-muted text-truncate mb-0">'+g.prof+'</p><p class="semester text-muted text-truncate mb-0">'+g.term+"</p></div></div></div></div>");g="";var k=0,h=0,d;for(d in f){var b=parseInt(f[d]);b>k&&(k=b);h++}k*=1.2;h=100/h;f=$jscomp.makeIterator(Object.values(f));for(b=f.next();!b.done;b=f.next())b=Math.ceil(100*(1-b.value/k)),g+='<div class="d-inline-block h-100" style="width: '+h+"%; background: linear-gradient(to bottom, #ced4da "+b+"%, #343a40 "+b+'%);"></div>';$("#card-"+
c).append(g)}}
function showMainChart(a){a=database[a];var c=a.term,g=a.subj,f=a.num,k=a.sect,h=a.prof,d=a.grades,b=Object.values(d).reduce(function(b,a){return b+parseInt(a)},0),e="A+ A A- B+ B B- C+ C C- D+ D D- F W I".split(" "),p="#2eb43f #30c737 #6bd40f #93d10d #cdff4f #ffe14d #ffd036 #ffc023 #ffad33 #ff704d #f54ad7 #f500a0 #dc3545 #dc4050 #336eb4".split(" ");Highcharts.chart("main-chart",{chart:{type:"column",backgroundColor:"#f8f9fa"},title:{text:g+" "+f+"."+k},subtitle:{text:h+" - "+c+" - "+b+" Students"},
legend:{enabled:!1},credits:{enabled:!1},xAxis:{title:{text:"Grades"},categories:Object.keys(d).map(function(b){return b||"Ungraded"})},yAxis:{title:{text:"Students"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'\n                <tr>\n                    <td style="color:{series.color};padding:0">{series.name}: </td>\n                    <td style="padding:0"><b>{point.y}</b></td>\n                </tr>\n                <tr>\n                    <td style="color:{series.color};padding:0">Percentage: </td>\n                    <td style="padding:0"><b>{point.percentage:.2f}%</b></td>\n                </tr>\n                ',
footerFormat:"</table>",backgroundColor:"#f8f9fa",borderColor:"#ced4da",borderRadius:6,useHTML:!0},series:[{name:"Students",data:function(){var a=[],c;for(c in d){var f=e.indexOf(c);a.push({color:-1===f?"#2986ff":p[f],y:parseInt(d[c]),percentage:d[c]/b*100})}return a}()}]});var m=h.split(",").reverse().map(function(a){return a.split(" ").map(function(a){return 1<a.length?a:""}).join(" ")}).join(" ");$("#btn_rmp").off("click").on("click",function(){window.open("https://www.ratemyprofessors.com/search.jsp?query="+
encodeURI(m+" UT Dallas"),"_blank")}).css("display","block");$("#btn_reddit").off("click").on("click",function(){window.open("https://www.reddit.com/r/utdallas/search/?q="+encodeURI(m)+"&restrict_sr=1","_blank")}).css("display","block")};