/* 
 *  Coded by Sai Tanay Desaraju.
 *  08/01/19.
 */

var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};var resJQ=$("#search-results"),maxResults=30,database={},searches=[],selected=new Set([]);
$(function(){$.getJSON("./data.json",function(a){database=a}).fail(function(){$("body").text("Error Occurred. Class data couldn't be loaded.")}).done(function(){$("#loading-spinner").fadeOut(200,function(){return $("#main-container").fadeIn(200)});if(0!==window.location.search.length){var a=new URLSearchParams(window.location.search),b=a.get("id");if(null!==b)b<Object.keys(database).length?(addClassSearchResults([b]),showMainChart(b)):console.log("Index "+b+" from url params equals or exceeds the database length. Class load failed.");
else{a=$jscomp.makeIterator(a.entries());for(b=a.next();!b.done;b=a.next())switch(b=b.value,b[0]){case "subj":$("#search-subj").val(b[1]);break;case "num":$("#search-num").val(b[1]);break;case "sect":$("#search-sect").val(b[1]);break;case "prof":$("#search-prof").val(b[1]);break;case "term":b[1]=b[1].toLowerCase();var f=b[1];switch(f[2]){case "s":f="Spring 20"+f[0]+f[1];break;case "f":f="Fall 20"+f[0]+f[1];break;case "u":f="Summer 20"+f[0]+f[1];break;default:console.log("term couldn't be parsed")}$("#search-term").attr("value",
f).text(b[1]);break;default:console.log("Couldn't parse URL param: "+b+"="+b[1])}refreshResults()}}})});
$(function(){$('[data-toggle="tooltip"]').tooltip();$('[data-toggle="popover"]').popover();$("#search-selectAll").on("click",function(){var a=$("#search-selectAll").is(":checked");$(".class-info-card > div > div:last-child > input").prop("checked",a);$(".class-info-card").each(function(){refreshSelectedBox(parseInt($(this).prop("id").substring(5)),!a)})});/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)&&$("#extension_footer").css("display","block")});
$(window).on("resize ready",function(){768<=$(window).width()?($("#search-input-group").removeClass("input-group-sm"),$("#search-term").removeClass("btn-sm")):($("#search-input-group").addClass("input-group-sm"),$("#search-term").addClass("btn-sm"))});$("#search-input-group > div > .dropdown-item").on("click",function(){$("#search-term").attr("value",$(this).text()).text($(this).attr("value"));refreshResults()});
function refreshResults(){var a=document.getElementById("search-subj").value.trim().toUpperCase(),b=document.getElementById("search-num").value.trim(),f=document.getElementById("search-sect").value.trim(),d=document.getElementById("search-prof").value.trim().toLowerCase(),g=document.getElementById("search-term").value;if(2>(""===a?0:1)+(""===b?0:1)+(""===f?0:1)+(1>d.length?0:2))resJQ.empty();else{"All"===g&&(g="");for(var k=[a,b,f,d,g],h=searches.length-1;0<=h;){for(var c=!0,e=0;5>e;e++)if(!k[e].startsWith(searches[h].query[e])){c=
!1;break}if(c)break;searches.pop();h--}if(0<searches.length){h=!0;c=searches[searches.length-1];for(e=0;5>e;e++)if(k[e]!==c.query[e]){h=!1;break}if(h){addClassSearchResults(searches[searches.length-1].result);return}}a=search(a,b,f,d,g);0===a.length?showNoResultsAlert():(addClassSearchResults(a),searches.push({query:k,result:a}))}}
function search(a,b,f,d,g){function k(c){if(c.subj.startsWith(a)&&c.num.startsWith(b)&&c.term.startsWith(g)&&c.sect.startsWith(f)){if(""===d)return!0;"string"===typeof d&&(d=d.split(" "));for(var k=$jscomp.makeIterator(d),e=k.next();!e.done;e=k.next()){e=e.value;for(var h=!1,l=$jscomp.makeIterator(c.prof_array),q=l.next();!q.done;q=l.next())if(q.value.startsWith(e)){h=!0;break}if(!h)return!1}return!0}return!1}var h=[],c=searches.length-1;if(-1===c)for(c=0;c<database.length;c++)k(database[c])&&h.push(c);
else{c=searches[c].result;for(var e=0;e<c.length;e++)k(database[c[e]])&&h.push(c[e])}return h}function showNoResultsAlert(){0===resJQ.find(".alert").length&&resJQ.fadeOut(30,function(){resJQ.empty();resJQ.append('<div class="alert alert-light" role="alert">No results found!</div>').fadeIn(200)})}
function addClassSearchResults(a){resJQ.empty();var b=maxResults,f={};a=$jscomp.makeIterator(a);for(var d=a.next();!d.done;f={$jscomp$loop$prop$x$20:f.$jscomp$loop$prop$x$20},d=a.next()){f.$jscomp$loop$prop$x$20=d.value;if(0>=b)break;d=database[f.$jscomp$loop$prop$x$20];var g=d.grades;resJQ.append('<div class="card class-info-card w-100 mr-3 mb-3 overflow-hidden" id="card-'+f.$jscomp$loop$prop$x$20+"\" onclick='showMainChart("+f.$jscomp$loop$prop$x$20+')\'><div class="row"><div class="class-graph col-4 pr-0 mh-100"></div><div class="col-6 col-md-6"><div class="card-body p-1"><p class="class-id font-weight-normal text-truncate mb-0">'+
d.subj.toUpperCase()+" "+d.num+" "+d.sect.toUpperCase()+'</p><p class="professor text-muted text-truncate mb-0">'+d.prof+'</p><p class="semester text-muted text-truncate">'+d.term+"</p></div></div><div class=\"col-2 btn_add d-flex justify-content-center align-items-center\"><input type='checkbox'"+(selected.has(f.$jscomp$loop$prop$x$20)?"checked":"")+"></div></div></div>");$("#card-"+f.$jscomp$loop$prop$x$20+" > div > div:last-child > input").on("click",function(a){return function(b){b.stopPropagation();
refreshSelectedBox(a.$jscomp$loop$prop$x$20,!$(this).is(":checked"))}}(f));d="";var k=0,h=0,c;for(c in g){var e=parseInt(g[c]);e>k&&(k=e);h++}k*=1.2;h=100/h;g=$jscomp.makeIterator(Object.values(g));for(e=g.next();!e.done;e=g.next())e=Math.ceil(100*(1-e.value/k)),d+='<div class="d-inline-block h-100" style="width: '+h+"%; background: linear-gradient(to bottom, #ced4da "+e+"%, #343a40 "+e+'%);"></div>';$("#card-"+f.$jscomp$loop$prop$x$20+" > div > .class-graph").append(d);--b}}
function showMainChart(a){if(a.isPrototypeOf(String)||Number.isInteger(a))a={indices:[parseInt(a)]};a.append=!1;var b="A+ A A- B+ B B- C+ C C- D+ D D- F I W CR NC P".split(" "),f="#2eb43f #30c737 #6bd40f #93d10d #cdff4f #ffe14d #ffd036 #ffc023 #ffad33 #ff704d #f54ad7 #f500a0 #dc3545 #336eb4 #dc4050".split(" ");a.append&&$("#main-chart").highcharts();var d=!a.append&&1===a.indices.length;$("#hint-text").hide();$("#btn_clear_chart").off("click").on("click",function(){$("#main-chart").empty();$("#btn_reddit").hide();
$("#btn_rmp").hide();$("#btn_share").hide();$("#btn_share").popover("hide")}).css("display","block");var g=$("#right_area_container");"none"===g.css("display")?$("#btn_back").off("click").on("click",function(){g.slideUp(300,function(){$("#left-bar").show(0,function(){d&&(window.location.hash="#card-"+a.indices[0])})});$("#btn_share").popover("hide")}).show(function(){return $("#left-bar").hide(0,function(){g.css("display","flex")})}):$("#btn_share").popover("hide");var k=0;for(var h=$jscomp.makeIterator(a.indices),
c=h.next();!c.done;c=h.next())index=c.value,k+=Object.values(database[index].grades).reduce(function(a,b){return a+parseInt(b)},0);if(d){var e=a.indices[0],l=database[e];h=l.subj;c=l.num;var p=l.sect,m=l.prof,r=l.term;l=l.grades;var n=m.split(",").reverse().map(function(a){return a.split(" ").map(function(a){return 1<a.length?a:""}).join(" ")}).join(" ");a.title=a.title||h+" "+c+"."+p;a.subtitle=a.subtitle||m+" - "+r+" - "+Object.values(l).reduce(function(a,b){return a+parseInt(b)},0)+" Students";
$("#btn_rmp").off("click").on("click",function(){window.open("https://www.ratemyprofessors.com/search.jsp?query="+encodeURI(n+" UT Dallas"),"_blank")}).css("display","block");$("#btn_reddit").off("click").on("click",function(){window.open("https://www.reddit.com/r/utdallas/search/?q="+encodeURI(n)+"&restrict_sr=1","_blank")}).css("display","block");$("#btn_share").attr("data-content",function(){return window.location.origin+"/utd-grades/?id="+e}).css("display","block")}else $("#btn_rmp").hide(),$("#btn_reddit").hide(),
$("#btn_share").hide();a.append||Highcharts.chart("main-chart",{chart:{type:"column",backgroundColor:"#f8f9fa"},title:{text:a.title||"Grade Distributions Chart"},subtitle:{text:a.subtitle||"Total: "+k+" students"},legend:{enabled:!d},credits:{enabled:!1},xAxis:{title:{text:"Grades"},type:"category"},yAxis:{title:{text:"Percentage"}},tooltip:{formatter:function(){if(a.merge){var b=function(){var a=this.points.map(function(a){return a.series.name});res="";a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=
a.next())res+="<tr><td class=\"text-truncate\" style='font-size:10px; max-width: 30ch'><b>"+b.value+"</b></td></tr>";return res}.call(this);var c=this.points[0].key;var f=this.points.map(function(a){return a.point.studentsWithCurGrade}).reduce(function(a,b){return a+b},0);var e=this.points[0].point.size}else b="<td class=\"text-truncate\" style='font-size:10px; max-width: 30ch'><b>"+this.series.name+"</b></td>",c=this.point.name,f=this.point.studentsWithCurGrade,e=this.point.size;var k=(100*f/e).toFixed(2);
return"\n                        <table>"+b+"<tr>\n                                <td style='color:#343a40;padding:0'>"+c+" : </td>\n                                <td style='padding:0'><b>"+f+"</b> students</td>\n                            </tr>\n                            <tr>\n                                <td style='color:#343a40;padding:0'>Out of : </td>\n                                <td style='padding:0'><b>"+e+"</b> students</td>\n                            </tr>\n                            <tr>\n                                <td style='color:#343a40;padding:0'>Percentage: </td>\n                                <td style='padding:0'><b>"+
k+"%</b></td>\n                            </tr>\n                        </table>\n                    "},backgroundColor:"#f8f9fa",borderColor:"#ced4da",borderRadius:6,useHTML:!0,shared:a.merge},plotOptions:{column:{stacking:"normal"},series:{animation:{complete:function(){$("#main-chart").highcharts().reflow()}}}},series:function(){for(var c=[],e=100/k,d={},h=$jscomp.makeIterator(a.indices),g=h.next();!g.done;d={$jscomp$loop$prop$grades$17$22:d.$jscomp$loop$prop$grades$17$22},g=h.next()){index=
g.value;g=database[index];var l=g.term,m=g.subj,n=g.num,p=g.sect;d.$jscomp$loop$prop$grades$17$22=g.grades;g=m+" "+n+" "+p+" "+l;a.merge||(k=Object.values(d.$jscomp$loop$prop$grades$17$22).reduce(function(a,b){return a+parseInt(b)},0),e=100/k);c.push({name:g,stack:a.merge?a.stackName||"":g,data:function(a){return function(){var c=[],d;for(d in a.$jscomp$loop$prop$grades$17$22){var g=b.indexOf(d),h=parseInt(a.$jscomp$loop$prop$grades$17$22[d]);c.push({name:d,studentsWithCurGrade:h,size:k,y:h*e,color:-1===
g?"#2986ff":f[g]})}return c}}(d)()})}return c}()},function(a){a.xAxis[0].setCategories(a.xAxis[0].names.sort(function(a,c){return b.indexOf(a)-b.indexOf(c)}).map(function(a){return a}))})}
function refreshSelectedBox(a,b){function f(a,b){b||selected.has(a)?b&&selected.has(a)&&(selected["delete"](a),$("#selected-"+a).fadeOut(function(){$("#selected-"+a).remove();0===selected.size&&$("#selected-box").fadeOut()})):(selected.add(a),$("#selected-box").is(":hidden")&&$("#selected-box").fadeIn(),$("#selected-box-content").append(function(){var b=database[a];return'<div class="flex-grow-0 bg-secondary border-right d-flex justify-content-center align-items-center" id="selected-'+a+'" style=\'display: none\'><p class="text-white m-3 m-md-2">'+
b.subj+" "+b.num+" "+b.sect+"</p></div>"}),$("#selected-"+a).fadeIn())}if(Array.isArray(a))for(var d=$jscomp.makeIterator(a),g=d.next();!g.done;g=d.next())f(g.value,b);else switch(a){case -1:case -2:showMainChart({append:!0,merge:-2===a,indices:Array.from(selected)});case -3:selected.clear();$("#selected-box").fadeOut(function(){return $("#selected-box-content").empty()});$(".class-info-card > div > div:last-child > input").prop("checked",!1);$("#search-selectAll").prop("checked",!1);break;default:f(a,
b)}};